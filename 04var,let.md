## let和var

为什么写循环，用 for(var i = 0)会产生问题，用let却不会？用var的弊端是什么？

```js
//使用var声明，得到3个3
var a = [];
for (var i = 0; i < 3; i++) {
  a[i] = function () {
    console.log(i);
  };
}
a[0](); //3
a[1](); //3
a[2](); //3

//使用let声明，得到0,1,2
var a = [];
for (let i = 0; i < 3; i++) {
  a[i] = function () {
    console.log(i);
  };
}
a[0](); //0
a[1](); //1
a[2](); //2
```

对于一个for循环，设置循环变量的地方是一个父作用域，循环体代码在一个子作用域内

JavaScript引擎内部会记住上一轮循环的值，初始化本轮变量i时，就在上一轮循环的基础上进行计算。（阮一峰ES6入门）

let在循环中产生了三个块级作用域（设断点可知）



在for循环中，每次执行都是一个全新的独立的块作用域
var命令有变量提升机制（不管写在函数哪里都会被提升到函数的最顶部），是全局变量，var命令实际只会执行一次，所以for循环内的setTimeout()等异步操作访问的都是同一个变量，从而达不到所需要的效果。let命令不存在变量提升，是局部变量，每次循环都会执行一次，**使用一个新变量**。



```js
for (var i = 0; i < 10; i++) {
  setTimeout(function(){
    console.log(i);
  },0)
}
// 输出十个 10

for (let j = 0; j < 10; j++) {
  setTimeout(function(){
    console.log(j);
  },0)
}
// 输出 0-9
```

setTimeout是个异步函数，它会在循环结束后再执行，第一个循环中的i用var声明，因此是个全局变量，当循环结束时，i=10，就会输出10个10.第二个循环的j是用let声明的，在每次循环中，setTimeout里的j都是独立的(局部作用域)，因此输出0-9.